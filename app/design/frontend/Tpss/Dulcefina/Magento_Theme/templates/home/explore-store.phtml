<link rel="stylesheet" href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>/waterfall/css/reset.css"><link rel="stylesheet" href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>/waterfall/css/waterfall.css"><script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>/waterfall/js/libs/jquery/jquery.js"></script><script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>/waterfall/js/libs/handlebars/handlebars.js"></script><script src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB) ?>/waterfall/js/waterfall.min.js"></script><?php $categories = Mage::getModel('catalog/category')    ->getCollection()    ->addAttributeToSelect('*')    ->addAttributeToFilter('is_active', 1)   ->addAttributeToFilter('include_in_menu', 1) ->addAttributeToSort('name','ASC');    $root_category = Mage::getModel('catalog/category')->load(2);    $subcategories = $root_category->getChildren();    $response = array();    $posts = array();    $heightarray = array("308", "277", "308", "308", "268", "308", "308", "310", "260", "248", "148", "148", "148", "148", "276", "276",        "307", "308", "212", "308");    $i = 1;   foreach($categories as $subcategory) {        $catid = $subcategory->getId();        $parentId=Mage::getModel('catalog/category')->load($catid)->getParentId();        if($catid != 8 && $parentId != 1 && $parentId != 8 && $parentId != 110){            $category = Mage::getModel('catalog/category')->load($catid);            $pid = array();                foreach ($category->getProductCollection() as $product) {                $pid[] = $product->getId();            }            $randomid = $pid[array_rand($pid)];            $product= Mage::getModel('catalog/product')->load($randomid);            $caturl = $category->getUrl();            $catname = $category->getName();            $height = $heightarray[array_rand($heightarray)];                        $imageurl = Mage::helper('catalog/image')->init($product, 'small_image')->resize(300,$height);            $page_title = $category->getMetaTitle();                        $posts[] = array('image'=> ''.$imageurl.'', 'url'=> $caturl, 'width'=> 300, 'height'=> $height, 'price'=> $page_title, "name"=> $catname);            $i++;        }    }$response['result'] = $posts;$count = count($posts);$response['total']= $count;$fp = fopen('waterfall/data/store/explore-store.json', 'w');fwrite($fp, json_encode($response));fclose($fp);?> <div id="container" style="width: auto; margin: 0 auto;"></div>    <script type="text/x-handlebars-template" id="waterfall-tpl">    {{#result}}        <div class="item">            <div class="price">                <span class="price">{{price}}</span>            </div>            <a href="{{url}}" style="background-image:url('{{image}}');height='{{height}}';">                <img src="" width="{{width}}" height="{{height}}" style="visibility:hidden;"/>            </a>            <a class="home-imgtitle" href="{{url}}">                <span>{{name}}</span><span class="home-arwimg"></span>            </a>        </div>    {{/result}}    </script>    <script>    $waterfall = jQuery.noConflict();    $waterfall('#container').waterfall({    itemCls: 'item',    colWidth: 300,      gutterWidth: 15,    gutterHeight: 15,    checkImagesLoaded: false,    callbacks: {        renderData: function (data, dataType) {            var tpl,                template,                resultNum = data.total;                            if (resultNum === <?php echo $count;?>) {                $waterfall('#container').waterfall('pause', function() {                                 });            }                if ( dataType === 'json' ||  dataType === 'jsonp'  ) {               tpl = $waterfall('#waterfall-tpl').html();                template = Handlebars.compile(tpl);                    return template(data);            } else {                 return data;            }        }    },    path: function(page) {        return '<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>waterfall/data/store/explore-store.json?page='+page;    }});</script><div style="float:left; width:100%;padding: 40px 0; clear: both;"><hr></div><?php $cat = Mage::getModel('catalog/category')->load(110);$subcats = $cat->getChildren();$response1 = array();$posts1 = array();$heightarray1 = array("308", "277", "308", "308", "268", "308", "308", "310", "260", "248", "148", "148", "148", "148", "276", "276",    "307", "308", "212", "308");$k=0;foreach(explode(',', $subcats) as $subcategory){    $categorycountry = Mage::getModel('catalog/category')->load($subcategory);    $cats[$categorycountry->getName()]=$subcategory;}foreach($cats as $subCatid){    $_category = Mage::getModel('catalog/category')->load($subCatid);          $baseurl = $this->getBaseUrl();       $catimg  = $_category->getImageUrl();    $catname = $_category->getName();    $caturls = $_category->getUrl();    $height1 = $heightarray1[array_rand($heightarray1)];    if($_category->getIsActive()){        if($_category->getImageUrl()){            $posts1[] = array('image'=> ''.$catimg.'', 'url'=> $caturls, 'width'=> '300', 'height'=> $height1, 'price'=> $page_title, "name"=> $catname);            $k++;        }    }}		  $response1['result'] = $posts1;$count = count($posts1);$response1['total']= $count;$fp = fopen('waterfall/data/store/explore-store-spl.json', 'w');fwrite($fp, json_encode($response1));fclose($fp);?><div id="container1" style="width: auto; margin: 0 auto;"></div>    <script type="text/x-handlebars-template" id="waterfall-tpl1">    {{#result}}        <div class="item">            <div class="price">                <span class="price">{{price}}</span>            </div>            <a href="{{url}}" style="background-image:url('{{image}}');height='{{height}}';">                <img src="" width="{{width}}" height="{{height}}" style="visibility:hidden;"/>            </a>            <a class="home-imgtitle" href="{{url}}">                <span>{{name}}</span><span class="home-arwimg"></span>            </a>        </div>    {{/result}}    </script>    <script>    $waterfall = jQuery.noConflict();    $waterfall('#container1').waterfall({    itemCls: 'item',    colWidth: 300,      gutterWidth: 15,    gutterHeight: 15,    checkImagesLoaded: false,    callbacks: {        renderData: function (data, dataType) {            var tpl,                template,                resultNum = data.total;                            if (resultNum === <?php echo $count;?>) {                $waterfall('#container1').waterfall('pause', function() {                                   });            }                if ( dataType === 'json' ||  dataType === 'jsonp'  ) {                 tpl = $waterfall('#waterfall-tpl1').html();                template = Handlebars.compile(tpl);                    return template(data);            } else {                 return data;            }        }    },    path: function(page) {        return '<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>waterfall/data/store/explore-store-spl.json?page='+page;    }});</script><style>    .item {        padding: 0px;        width: 300px;    }    .item a {        float:left;        background-position: 50% 50%;        background-clip: border-box;        background-color: rgba(0, 0, 0, 0);        background-repeat: no-repeat;        background-size: cover;        background-attachment: scroll;        background-clip: border-box;        background-origin: padding-box;        width: 300px !important;    }            .price {        color: #A8A8A8;        font-family: helvetica;        font-size: 15px;        font-weight: normal;        margin-left: 5px;        margin-top: 3px;        position: absolute;    }    .home-imgtitle {        opacity: 0.6;    }    .home-imgtitle span {        opacity: 1;        color: #FFFFFF !important;               font-size: 18px !important;    }    .item:hover a.home-imgtitle{        background: none repeat scroll 0 0 #E1931E;    }    #container1 {        clear:both;    }    #waterfall-loading {        display: none;    }</style>